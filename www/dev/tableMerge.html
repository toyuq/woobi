<!DOCTYPE html>
<html lang="en">
<head>
  <title>INDEX.HTML</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
</head>
<body>

<div class="container">

  <h2>Welcome to toyuq's HomePage</h2>
  
  <div class="well">
	<p>test 123</p>
	<p>반갑습니다.</p>
	<p>Table Cell Merge 기능 테스트</p>
  </div>
  <button onclick="fn_cellMerge('tableList', [0,1,2])">test!!</button>
  <table class="table table-bordered" id="tableList">
	<thead>
	  <tr>
		<th>과일</th>
		<th>원산지</th>
		<th>색깔</th>
		<th>가격</th>
	  </tr>
	</thead>
	<tbody>
	  <tr>
		<td>복숭아</td>
		<td>서울</td>
		<td>빨강</td>
		<td>5000</td>
	  </tr>
	  <tr>
		<td>사과</td>
		<td>서울</td>
		<td>빨강</td>
		<td>2000</td>
	  </tr>
	  <tr>
		<td>사과</td>
		<td>서울</td>
		<td>빨강</td>
		<td>3000</td>
	  </tr>
	  <tr>
		<td>사과</td>
		<td>서울</td>
		<td>초록</td>
		<td>5000</td>
	  </tr>
	  <tr>
		<td>사과</td>
		<td>서울</td>
		<td>초록</td>
		<td>7000</td>
	  </tr>
	  <tr>
		<td>사과</td>
		<td>광주</td>
		<td>초록</td>
		<td>5000</td>
	  </tr>
	  <tr>
		<td>사과</td>
		<td>광주</td>
		<td>노랑</td>
		<td>5000</td>
	  </tr>
	  <tr>
		<td>배</td>
		<td>광주</td>
		<td>노랑</td>
		<td>5000</td>
	  </tr>
	  <tr>
		<td>감귤</td>
		<td>광주</td>
		<td>노랑</td>
		<td>7000</td>
	  </tr>
	  <tr>
		<td>감귤</td>
		<td>광주</td>
		<td>검정</td>
		<td>3000</td>
	  </tr>
	  <tr>
		<td>감귤</td>
		<td>부산</td>
		<td>노랑</td>
		<td>7000</td>
	  </tr>
	  <tr>
		<td>포도</td>
		<td>부산</td>
		<td>노랑</td>
		<td>7000</td>
	  </tr>
	  <tr>
		<td>포도</td>
		<td>대전</td>
		<td>노랑</td>
		<td>7000</td>
	  </tr>
	  <tr>
		<td>파인애플</td>
		<td>대전</td>
		<td>노랑</td>
		<td>7000</td>
	  </tr>
	</tbody>
  </table>
  
    <button onclick="fn_cellMerge('tableList2', [0,1,2])">test!!</button>
  <table class="table table-bordered" id="tableList2">
	<thead>
	  <tr>
		<th>과일</th>
		<th>원산지</th>
		<th>색깔</th>
		<th>가격</th>
	  </tr>
	</thead>
	<tbody>
	  <tr>
		<td>복숭아</td>
		<td>서울</td>
		<td>빨강</td>
		<td>5000</td>
	  </tr>
	</tbody>
  </table>
  
  <button onclick="fn_cellMerge('tableList3', [0,1,2])">test!!</button>
  <table class="table table-bordered" id="tableList3">
	<thead>
	  <tr>
		<th>과일</th>
		<th>원산지</th>
		<th>색깔</th>
		<th>가격</th>
	  </tr>
	</thead>
	<tbody>
	  <tr>
		<td>복숭아</td>
		<td>서울</td>
		<td>빨강</td>
		<td>5000</td>
	  </tr>
	  <tr>
		<td>사과</td>
		<td>서울</td>
		<td>빨강</td>
		<td>2000</td>
	  </tr>
	  <tr>
		<td>배</td>
		<td>광주</td>
		<td>노랑</td>
		<td>5000</td>
	  </tr>
	  <tr>
		<td>배</td>
		<td>광주</td>
		<td>노랑</td>
		<td>5000</td>
	  </tr>
	  <tr>
		<td>감귤</td>
		<td>광주</td>
		<td>노랑</td>
		<td>7000</td>
	  </tr>
	  <tr>
		<td>감귤</td>
		<td>광주</td>
		<td>검정</td>
		<td>7000</td>
	  </tr>
	  <tr>
		<td>포도</td>
		<td>부산</td>
		<td>노랑</td>
		<td>7000</td>
	  </tr>
	  <tr>
		<td>파인애플</td>
		<td>대전</td>
		<td>노랑</td>
		<td>7000</td>
	  </tr>
	</tbody>
  </table>
</div>
</body>
<script>
$(document).ready(function(){

	
});

/** Function, Table Cell Merge 
 *
 * @param : table id
 * @param : arrangement of column, ex) [0, 1, 2]
 * @param : group tag of column [option]
 * @author : toyuq
 * @version : 2017.09.22
 */  
function fn_cellMerge(vid, vcol, vtd){ //테이블 아이디, 셀머지할 컬럼 0부터~, 태그(옵션)
   
   
	   
	var id = vid;
	var col = vcol;
	var td = ((!!vtd) ? vtd : "td"  ); // 기본이 td 태그 기준으로 merge함
	   
	var spanCnt = 1;
	var preText; //이전 텍스트
	
	var r = [];

	var rows = $("table[id="+id+"] tr").find(td+":eq("+col[0]+")").length; //row 개수 
	
	if(rows <= 1){
		return false;
	}
	
	
	
	for(var i = 0; col.length > i; i++){
	
		r.push({ idx : [], spans : []});
	
		if(i == 0){ //첫번째
		
			$("table[id="+id+"] tr").find(td+":eq("+col[i]+")").each(function(index, item){// row수만큼 돌린다.
			   
				if(index == 0) { //첫번째 row
				   
					r[i].idx.push(index);
					spanCnt = 1;
			   
				}else if( (rows-1) == index){ //마지막 row
				
					if(preText != $(this).text()){ //중복없이 단일행 마지막
					
						console.log("안중복");
						r[i].idx.push(index);
						r[i].spans.push(spanCnt);
						
					}else{ //전 값이 동일한 경우
					
						console.log("안중복 : " + spanCnt);
						spanCnt = spanCnt+1;
						r[i].spans.push(spanCnt);
					}
					
				}else if(preText != $(this).text()){ //텍스트가 바뀔때 index
				   
					r[i].idx.push(index);
					r[i].spans.push(spanCnt);
					spanCnt = 1;
			   
				}else{ //위 아래 텍스트가 같을 때
				   
					spanCnt = spanCnt+1;
				}
				preText = $(this).text();
			});
		}else if( !r[i-1].idx.length){ // rowSpan할 row가 없다면 종료
		
			break;
			
		}else{ //그 뒤 그룹으로
		
			var j = 1; //그룹 구별자
			
			$("table[id="+id+"] tr").find(td+":eq("+col[i]+")").each(function(index, item){// row수만큼 돌린다.
			   
			   
				if(index == 0) { //첫번째 row
				   
					r[i].idx.push(index);
					spanCnt = 1;
			   
				}else if(r[i-1].idx[j] == (index)){ //rowSpan 적용 시작 지점에서 리셋
				    
					r[i].idx.push(index);
					r[i].spans.push(spanCnt);
					spanCnt = 1;
					j++;
				   
				}else if( (rows-1) == index){ //마지막 row
				
					if(preText != $(this).text()){ //중복없이 단일행 마지막
					
						console.log("안중복");
						r[i].idx.push(index);
						r[i].spans.push(spanCnt);
						
					}else{ //전 값이 동일한 경우
					
						console.log("안중복 : " + spanCnt);
						spanCnt = spanCnt+1;
						r[i].spans.push(spanCnt);
					}
				   
				}else if(preText != $(this).text()){ //텍스트가 바뀔때 index
				   
					r[i].idx.push(index);
					r[i].spans.push(spanCnt);
					spanCnt = 1;
			   
				}else{ //위 아래 텍스트가 같을 때
				   
					spanCnt = spanCnt+1;
				}
				preText = $(this).text();
			});
		}
	}

	
	for(var k = col.length; k > 0; k--){ //역순으로 돌려야 그룹이 안깨짐
	
		$("table[id="+id+"] tr").find(td+":eq("+col[k-1]+")").each(function(index, item){
	   
			if(r[k-1].idx[0] == index){
			   
				$(this).attr("rowspan",r[k-1].spans[0]);
			   
				r[k-1].idx.shift();
				r[k-1].spans.shift();
			   
			}else{
			   
				$(this).remove();
			}
		});
	
	}
}

</script>
</html>



